#!/bin/sh

start_total=`date +%s`

sudo apt-get update
sudo apt-get upgrade
# install pip and pip3
sudo apt-get install python-pip python3-pip
# remove old versions, if not placed in a virtual environment (let pip search for them)
sudo pip uninstall tensorflow
sudo pip3 uninstall tensorflow
# install the dependencies (if not already onboard)
sudo apt-get install gfortran
sudo apt-get install libhdf5-dev libc-ares-dev libeigen3-dev
sudo apt-get install libatlas-base-dev libopenblas-dev libblas-dev
sudo apt-get install liblapack-dev
# upgrade setuptools 47.1.1 -> 57.0.0
sudo -H pip3 install --upgrade setuptools
# utmost important: use only numpy version 1.19.5
sudo -H pip3 install numpy==1.19.5
sudo -H pip3 install pybind11
sudo -H pip3 install Cython
# install h5py with Cython version 0.29.23 (± 6 min @1950 MHz)
sudo -H pip3 install h5py==3.1.0
sudo -H pip3 install --upgrade wrapt
sudo -H pip3 install gast==0.4.0
sudo -H pip3 install absl-py astunparse
sudo -H pip3 install flatbuffers google_pasta
sudo -H pip3 install keras_preprocessing --no-deps
sudo -H pip3 install opt_einsum protobuf
sudo -H pip3 install six termcolor wheel
sudo -H pip3 install typing_extensions
# install gdown to download from Google drive
pip3 install gdown
# download the wheel
gdown https://drive.google.com/uc?id=1I1H2xMs4BTm-UQhBPuLgqnLgmE0ATRl5
# install TensorFlow 2.5.0 (± 108 min @1950 MHz)
sudo -H pip3 install tensorflow-2.5.0-cp38-cp38-linux_aarch64.whl

end_total=`date +%s`

time_total=$((end_total-start_total))

echo "#################################################"
echo "# Tensorflow installation completed                             #"
echo "#################################################"
echo ""
echo "Time for total install:     ${time_total} s"
echo ""
echo "#################################################"
exit 0